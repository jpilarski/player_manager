<Window x:Class="Pilarski.PlayerManager.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Pilarski.PlayerManager.UI"
        xmlns:interfaces="clr-namespace:Pilarski.PlayerManager.Interfaces;assembly=Pilarski.PlayerManager.Interfaces"
        xmlns:converters="clr-namespace:Pilarski.PlayerManager.UI.Converters"
        mc:Ignorable="d"
        
        Title="Player Manager"
        WindowState="Maximized"
        Icon="/app_logo.ico"
        Height="720" Width="1280"
        MinWidth="1080" MinHeight="640"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource PrimaryBackgroundBrush}">

    <Window.Resources>
        <converters:ImagePathToBitmapConverter x:Key="PathToImageConv"/>
        <converters:BooleanToVisibilityConverter x:Key="BoolToVis" Inverted="False"/>
        <converters:BooleanToVisibilityConverter x:Key="InvertedBoolToVis" Inverted="True"/>
        <BitmapImage x:Key="DefaultAppIcon" UriSource="/app_logo.ico"/>

        <!-- General Styles -->
        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{DynamicResource PrimaryForegroundBrush}"/>
        </Style>
        <Style TargetType="Button">
            <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryForegroundBrush}"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource ButtonMouseOverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="{DynamicResource ButtonIsPressedBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="DeleteButton" TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
            <Setter Property="Background" Value="{DynamicResource ErrorBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource DeleteButtonMouseOverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="{DynamicResource DeleteButtonIsPressedBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="ListBox">
            <Setter Property="Background" Value="{DynamicResource SecondaryBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
        </Style>
        <Style TargetType="ListBoxItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border Background="{TemplateBinding Background}" Padding="5" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0 0 0 1">
                            <ContentPresenter/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="{DynamicResource TertiaryBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="5"/>
        </Style>
        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="{DynamicResource TertiaryBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="5"/>
        </Style>

        <!-- DataTemplate for when no club or player is selected -->
        <DataTemplate x:Key="EmptyDetailsViewTemplate">
            <Grid Background="{DynamicResource TertiaryBackgroundBrush}">
                <Image Source="{StaticResource DefaultAppIcon}" Width="128" Height="128" Opacity="0.5"/>
            </Grid>
        </DataTemplate>

        <!-- DataTemplate for Club ListBox Items -->
        <DataTemplate x:Key="ClubListItemTemplate" DataType="{x:Type interfaces:IClub}">
            <StackPanel Orientation="Horizontal">
                <Image Width="40" Height="40" Stretch="Uniform" VerticalAlignment="Center"
                       Source="{Binding ImagePath, Converter={StaticResource PathToImageConv}, FallbackValue={StaticResource DefaultAppIcon}}"/>
                <TextBlock Text="{Binding Name}" VerticalAlignment="Center" Margin="10,0,0,0" FontWeight="SemiBold"/>
            </StackPanel>
        </DataTemplate>

        <!-- DataTemplate for Player ListBox Items -->
        <DataTemplate x:Key="PlayerListItemTemplate" DataType="{x:Type interfaces:IPlayer}">
            <StackPanel Orientation="Horizontal">
                <Image Width="40" Height="40" Stretch="Uniform" VerticalAlignment="Center"
                       Source="{Binding ImagePath, Converter={StaticResource PathToImageConv}, FallbackValue={StaticResource DefaultAppIcon}}"/>
                <TextBlock Text="{Binding Name}" VerticalAlignment="Center" Margin="10,0,0,0" FontWeight="SemiBold"/>
            </StackPanel>
        </DataTemplate>

        <!-- DataTemplate for displaying Club Details -->
        <DataTemplate x:Key="ClubDetailsTemplate" DataType="{x:Type interfaces:IClub}">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="15">
                    <Border BorderBrush="{DynamicResource AccentBrush}" BorderThickness="2" CornerRadius="5" Width="150" Height="150" HorizontalAlignment="Left">
                        <Image Source="{Binding ImagePath, Converter={StaticResource PathToImageConv}, FallbackValue={StaticResource DefaultAppIcon}}" Stretch="Uniform"/>
                    </Border>
                    <Grid Margin="0,20,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Name:" FontWeight="Bold" Margin="5"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding Name}" Margin="5"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Country:" FontWeight="Bold" Margin="5"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Country}" Margin="5"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Founded:" FontWeight="Bold" Margin="5"/>
                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding FoundingYear}" Margin="5"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Rival:" FontWeight="Bold" Margin="5"/>
                        <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding RivalClubId}" Margin="5"/>

                        <TextBlock Grid.Row="4" Grid.Column="0" Text="Stadium:" FontWeight="Bold" Margin="5"/>
                        <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding Stadium}" Margin="5"/>

                        <TextBlock Grid.Row="5" Grid.Column="0" Text="Value:" FontWeight="Bold" Margin="5"/>
                        <TextBlock Grid.Row="5" Grid.Column="1" Text="€ [Calculation TBD]" Margin="5" FontStyle="Italic"/>
                    </Grid>
                </StackPanel>
            </ScrollViewer>
        </DataTemplate>
        
        <DataTemplate x:Key="ClubEditTemplate">
            <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="10">
                <StackPanel DataContext="{Binding ClubInEdit}">
                    <TextBlock Text="Club Details" FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>

                    <TextBlock Text="Name:"/>
                    <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,10"/>

                    <TextBlock Text="Country:"/>
                    <ComboBox ItemsSource="{Binding DataContext.Countries, RelativeSource={RelativeSource AncestorType=Window}}" 
                              SelectedValue="{Binding Country}" Margin="0,0,0,10}"/>

                    <Grid Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0" Margin="0,0,5,0">
                            <TextBlock Text="Founding Year:"/>
                            <TextBox Text="{Binding FoundingYear, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" Margin="5,0,0,0">
                            <TextBlock Text="Stadium:"/>
                            <TextBox Text="{Binding Stadium, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                    </Grid>

                    <TextBlock Text="Rival:"/>
                    <ComboBox ItemsSource="{Binding DataContext.Clubs, RelativeSource={RelativeSource AncestorType=Window}}"
                              DisplayMemberPath="Name"
                              SelectedValuePath="Id"
                              SelectedValue="{Binding RivalClubId}" Margin="0,0,0,10}"/>
                    
                    <TextBlock Text="Logo:"/>
                    <StackPanel Orientation="Horizontal" Margin="0,5,0,10">
                        <Button Content="Select Image..." Command="{Binding DataContext.SelectLogoCommand, RelativeSource={RelativeSource AncestorType=Window}}" Width="120"/>
                        <Image Source="{Binding ImagePath, Converter={StaticResource PathToImageConv}, FallbackValue={StaticResource DefaultAppIcon}}" 
                               Width="40" Height="40" Margin="10,0,0,0"/>
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
                        <Button Content="Save" Command="{Binding DataContext.SaveClubCommand, RelativeSource={RelativeSource AncestorType=Window}}" Width="100" Margin="0,0,10,0" Background="{DynamicResource SuccessBrush}"/>
                        <Button Content="Cancel" Command="{Binding DataContext.CancelClubEditCommand, RelativeSource={RelativeSource AncestorType=Window}}" Width="100"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </DataTemplate>
        
        <!-- DataTemplate for displaying Player Details -->
        <DataTemplate x:Key="PlayerDetailsTemplate" DataType="{x:Type interfaces:IPlayer}">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="15">
                    <Border BorderBrush="{DynamicResource AccentBrush}" BorderThickness="2" CornerRadius="5" Width="150" Height="150" HorizontalAlignment="Left">
                        <Image Source="{Binding ImagePath, Converter={StaticResource PathToImageConv}, FallbackValue={StaticResource DefaultAppIcon}}" Stretch="Uniform"/>
                    </Border>
                    <Grid Margin="0,20,0,0">
                         <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Name:" FontWeight="Bold" Margin="5"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding Name}" Margin="5"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Nationality:" FontWeight="Bold" Margin="5"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Nationality}" Margin="5"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Position:" FontWeight="Bold" Margin="5"/>
                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding Position}" Margin="5"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Value:" FontWeight="Bold" Margin="5"/>
                        <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding MarketValue, StringFormat=€{0:N0}}" Margin="5"/>

                        <TextBlock Grid.Row="4" Grid.Column="0" Text="Club:" FontWeight="Bold" Margin="5"/>
                        <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding ClubId}" Margin="5"/>
                    </Grid>
                </StackPanel>
            </ScrollViewer>
        </DataTemplate>
        
        <Style x:Key="ClubDetailsViewStyle" TargetType="ContentControl">
            <Setter Property="Background" Value="{DynamicResource TertiaryBackgroundBrush}"/>
            <Setter Property="ContentTemplate" Value="{StaticResource ClubDetailsTemplate}"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding SelectedClub}" Value="{x:Null}">
                    <Setter Property="ContentTemplate" Value="{StaticResource EmptyDetailsViewTemplate}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        
        <Style x:Key="PlayerDetailsViewStyle" TargetType="ContentControl">
            <Setter Property="Background" Value="{DynamicResource TertiaryBackgroundBrush}"/>
            <Setter Property="ContentTemplate" Value="{StaticResource PlayerDetailsTemplate}"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding SelectedPlayer}" Value="{x:Null}">
                    <Setter Property="ContentTemplate" Value="{StaticResource EmptyDetailsViewTemplate}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

    </Window.Resources>

    <Grid Margin="5">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" MinWidth="400"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*" MinWidth="400"/>
        </Grid.ColumnDefinitions>

        <!-- CLUBS PANEL (LEFT) -->
        <Border Grid.Column="0" Background="{DynamicResource SecondaryBackgroundBrush}" CornerRadius="5" Margin="5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock Grid.Row="0" Text="CLUBS" FontSize="20" FontWeight="Bold" Margin="10" HorizontalAlignment="Center"/>
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" MinWidth="150"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="3*" MinWidth="200"/>
                    </Grid.ColumnDefinitions>

                    <!-- Club List Section -->
                    <Grid Grid.Column="0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Button Grid.Row="0" Content="Filters" Margin="5" ToolTip="Filtering not implemented yet"/>
                        <ListBox Grid.Row="1" ItemsSource="{Binding Clubs}" SelectedItem="{Binding SelectedClub}"
                                 ItemTemplate="{StaticResource ClubListItemTemplate}"
                                 HorizontalContentAlignment="Stretch"/>
                        <Button Grid.Row="2" Content="Add Club" Command="{Binding AddClubCommand}" Margin="5" Background="{DynamicResource SuccessBrush}"/>
                    </Grid>

                    <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Center" VerticalAlignment="Stretch"/>

                    <!-- Club Details Section -->
                    <Grid Grid.Column="2">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <ContentControl Grid.Row="0" DataContext="{Binding}" ContentTemplate="{StaticResource ClubEditTemplate}"
                                        Visibility="{Binding IsAddingOrEditingClub, Converter={StaticResource BoolToVis}}"/>
                        
                        <ContentControl Grid.Row="0" Content="{Binding}" Style="{StaticResource ClubDetailsViewStyle}"
                                        Visibility="{Binding IsAddingOrEditingClub, Converter={StaticResource InvertedBoolToVis}}"/>

                        <StackPanel Grid.Row="1" Margin="10" Visibility="{Binding IsAddingOrEditingClub, Converter={StaticResource InvertedBoolToVis}}">
                            <Button Content="Edit" Command="{Binding EditClubCommand}" Margin="0,0,0,5"/>
                            <Button Content="Delete" Command="{Binding DeleteClubCommand}" Style="{StaticResource DeleteButton}"/>
                        </StackPanel>
                    </Grid>
                </Grid>
            </Grid>
        </Border>

        <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Center" VerticalAlignment="Stretch"/>

        <!-- PLAYERS PANEL (RIGHT) -->
        <Border Grid.Column="2" Background="{DynamicResource SecondaryBackgroundBrush}" CornerRadius="5" Margin="5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock Grid.Row="0" Text="PLAYERS" FontSize="20" FontWeight="Bold" Margin="10" HorizontalAlignment="Center"/>
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" MinWidth="150"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="3*" MinWidth="200"/>
                    </Grid.ColumnDefinitions>

                    <!-- Player List Section -->
                    <Grid Grid.Column="0">
                         <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Button Grid.Row="0" Content="Filters" Margin="5" ToolTip="Filtering not implemented yet"/>
                        <ListBox Grid.Row="1" ItemsSource="{Binding Players}" SelectedItem="{Binding SelectedPlayer}"
                                 ItemTemplate="{StaticResource PlayerListItemTemplate}"
                                 HorizontalContentAlignment="Stretch"/>
                        <Button Grid.Row="2" Content="Add Player" Command="{Binding AddPlayerCommand}" Margin="5" Background="{DynamicResource SuccessBrush}"/>
                    </Grid>

                    <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Center" VerticalAlignment="Stretch"/>

                    <!-- Player Details Section -->
                    <Grid Grid.Column="2">
                         <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <ContentControl Grid.Row="0" Content="{Binding}" Style="{StaticResource PlayerDetailsViewStyle}"/>

                        <StackPanel Grid.Row="1" Margin="10">
                            <Button Content="Edit" Command="{Binding EditPlayerCommand}" Margin="0,0,0,5"/>
                            <Button Content="Delete" Command="{Binding DeletePlayerCommand}" Style="{StaticResource DeleteButton}"/>
                        </StackPanel>
                    </Grid>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</Window>